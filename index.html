<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpinejs</title>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

</head>

<body>

    <div x-data="cars" class="container">
        <h1>Car Widget</h1>
        <div class="row">
            <div class="col">
                <select x-on:change="filterByTown" class="form-select form-select-sm"
                    aria-label=".form-select-sm example">
                    <option>Town filter</option>
                    <template x-for="town in townDropDown">
                        <option x-bind:value="town" x-text="town">
                        </option>
                    </template>
                </select>
            </div>
            <div class="col">
                <select x-on:change="filterByModel" class="form-select form-select-sm"
                    aria-label=".form-select-sm example">
                    <option selected>Model filter</option>
                    <template x-for="model in modelDropDown">
                        <option x-bind:value="model" x-text="model"></option>
                    </template>
                </select>
            </div>
            <div class="col">
                <select x-on:change="filterByColor" class="form-select form-select-sm"
                    aria-label=".form-select-sm example">
                    <option selected>Color filter</option>
                    <template x-for="color in colorDropDown">
                        <option x-bind:value="color" x-text="color"></option>
                    </template>
                </select>
            </div>
        </div>
        <div></div>

        <!-- <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
            <label class="form-check-label" for="inlineRadio2">Least popular</label>
        </div> -->

        <div class="container">
            <div class="row">

                <h1></h1>
                <div class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive"
                    aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            Hello, world! This is a toast message.
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                            aria-label="Close"></button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-check form-check-inline">
                            <input x-on:click="mostPopularMake" class="form-check-input" type="radio"
                                name="inlineRadioOptions" id="inlineRadio1" value="option1">
                            <label class="form-check-label" for="inlineRadio1">Most popular <strong x-text=""
                                    class="selectedCount"></strong></label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <strong x-text="filteredList.length">0</strong> Available

                        <div>
                            <strong x-text="filterMsg" class="">0</strong>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <hr>

        <table x-show="filteredList.length > 0" class="table table-bordered border-primary">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Make</th>
                    <th scope="col">Model</th>
                    <th scope="col">Color</th>
                    <th scope="col">Registration No</th>
                    <th scope="col">Town</th>
                </tr>
            </thead>

            <tbody>
                <template x-for="(item, index) in filteredList">
                    <tr>
                        <th x-text="index+1" scope="row">1</th>
                        <td x-text="item.make"></td>
                        <td x-text="item.model"></td>
                        <td x-text="item.color"></td>
                        <td x-text="item.reg_number"></td>
                        <td x-text="item.town"></td>
                    </tr>
                </template>
            </tbody>
        </table>

    </div>

    <!-- ===============================Alpine data===================== -->
    <!-- =============================================================== -->

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('cars', () => ({
                data: [],
                filteredList: data,
                isFound: true,
                filterMsg: "",
                townDropDown: {},
                modelDropDown: {},
                colorDropDown: {},
                towFilter: {
                    Paarl: "CJ",
                    Bellville: "CY",
                    Stellenbosch: "CL",
                    Malmesbury: "CK",
                    "Cape Town": "CA",
                    Kuilsriver: "CF"
                },

                init() {
                    this.data = data;
                    this.filteredList = data;
                    this.buildDropDown();
                },

                mostPopularMake() {
                    const fIlterInstance = Filter();
                    const carsArray = this.data;
                    const mostPopular = fIlterInstance.mostPopular(carsArray);
                    const filteredList = this.data.filter(car => {
                        return car.make === mostPopular;
                    });
                    this.filterMsg = `The most popular make is ${mostPopular}`;
                    this.filteredList = filteredList;
                },

                filterByTown(e) {
                    const val = e.currentTarget.value;
                    const filteredList = this.data.filter(car => {
                        return car.reg_number.startsWith(this.towFilter[val])
                    });
                    this.filteredList = filteredList;
                },

                filterByModel(e) {
                    const model = e.currentTarget.value;
                    const filteredList = this.data.filter(car => {
                        return car.model === model;
                    });
                    this.filteredList = filteredList;
                },

                filterByColor(e) {
                    const color = e.currentTarget.value;
                    const filteredList = this.data.filter(car => {
                        return car.color === color;
                    });
                    this.filteredList = filteredList;
                },

                buildDropDown() {
                    let townDropDown = {}
                    let modelDropDown = {}
                    let colorDropDown = {}

                    this.data.forEach(item => {
                        townDropDown[item.town] = item.town;
                        modelDropDown[item.model] = item.model;
                        colorDropDown[item.color] = item.color;
                    });

                    this.townDropDown = townDropDown;
                    this.modelDropDown = modelDropDown;
                    this.colorDropDown = colorDropDown;
                }

            }))
        })
    </script>

    <script src="./filter.js"></script>
    <script src="./data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
</body>

</html>